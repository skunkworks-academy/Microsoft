
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Skunkworks • AZ-040 Cheat Sheet — Jobs Management with PowerShell</title>
<style>
:root{--bg:#fcfcfe;--card:#ffffff;--ink:#0b1220;--muted:#5d6b83;--accent:#2563eb;--chip:#eef2ff}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Helvetica,Arial,sans-serif;color:var(--ink);background:linear-gradient(180deg,var(--bg),#f7faff)}
.container{max-width:1100px;margin:auto;padding:28px}
.header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
.logo{width:36px;height:36px;border-radius:10px;background:#111827;color:#fff;display:grid;place-items:center;font-weight:700}
.brand{font-weight:700;letter-spacing:.3px}
.spacer{flex:1}
.badge{font-weight:600;font-size:12px;color:#1f2937;background:var(--chip);border:1px solid #d1d5ff;padding:6px 10px;border-radius:999px}
.h1{font-size:28px;margin:10px 0 4px 0}
.sub{color:var(--muted);margin:0 0 16px 0}
.card{background:var(--card);border:1px solid #e6eaf5;border-radius:16px;padding:18px;margin:14px 0;box-shadow:0 1px 0 rgba(12,23,41,.03)}
h2{font-size:18px;margin:0 0 8px;color:#0b1220}
p{color:var(--muted);margin:6px 0 12px;line-height:1.55}
ul{margin:0 0 0 20px}
li{margin:6px 0}
.code{background:#0b122005;border:1px solid #e7e9f2;border-radius:12px;padding:12px;overflow:auto}
pre,code{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
.kv{display:flex;gap:8px;flex-wrap:wrap}
.kv span{background:var(--chip);border:1px solid #d1d5ff;border-radius:999px;padding:6px 10px;font-size:12px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #edf0f7;padding:10px 8px;text-align:left;vertical-align:top}
.table th{color:#111827}
.two{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media (max-width:900px){.two{grid-template-columns:1fr}}
.footer{font-size:12px;color:#6b7280;margin-top:14px}
hr{border:0;border-top:1px solid #e6eaf5;margin:18px 0}
kbd{border:1px solid #c7ccdb;border-bottom-width:2px;border-radius:6px;padding:1px 6px;background:#fff;font-size:12px}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">S</div>
    <div>
      <div class="brand">Skunkworks • AZ-040 Revision</div>
      <div class="sub">One-pager: Jobs Management with PowerShell</div>
    </div>
    <div class="spacer"></div>
    <span class="badge">2025-08-22</span>
  </div>

  <div class="card">
    <div class="h1">Objective</div>
    <p>Run long tasks asynchronously, manage background/remote jobs, and schedule recurring tasks.</p>
    <div class="kv"><span>Start-Job</span><span>Invoke-Command -AsJob</span><span>Get/Wait/Receive-Job</span><span>Stop-Job</span><span>Register-ScheduledJob</span><span>Get-ScheduledJob</span></div>
  </div>

  <div class="card">
    <h2>Quick Reference (copy & paste)</h2>
<pre class="code"># 1) Start a remote job against multiple servers
$servers = "LON-DC1","LON-SVR1"
Invoke-Command -ComputerName $servers -ScriptBlock { Get-SmbShare } -AsJob -JobName "RemoteShares"

# 2) Start a local background job
Start-Job -Name LocalSecurity -ScriptBlock { Get-WinEvent -LogName Security }

# 3) Monitor jobs
Get-Job                          # list all
Get-Job -Name Remote*            # filter by name
Wait-Job *                       # wait for completion

# 4) Receive results (and keep for later if needed)
Receive-Job -Name RemoteShares -Keep | Format-Table -Auto

# 5) Stop a runaway job
Stop-Job -Name LocalDir -Force

# 6) Scheduled job (PS 5.1 ScheduledJobs module)
$option   = New-ScheduledJobOption -WakeToRun -RunElevated
$trigger1 = New-JobTrigger -Once -At ((Get-Date).AddMinutes(5))
Register-ScheduledJob -Name LocalSecurityLog `
  -ScriptBlock { Get-WinEvent -LogName Security } `
  -ScheduledJobOption $option -Trigger $trigger1

Get-ScheduledJob -Name LocalSecurityLog | Get-JobTrigger
# Later:
Receive-Job -Name LocalSecurityLog</pre>
    <p class="sub">Tip: For fan‑out, prefer <code>Invoke-Command -AsJob</code> over spawning many local <code>Start-Job</code> calls—less client CPU and cleaner fan-in.</p>
  </div>

  <div class="two">
    <div class="card">
      <h2>What you did</h2>
      <ul>
        <li>Started remoting jobs to collect network adapters/SMB shares from multiple servers.</li>
        <li>Launched local jobs that processed event logs and heavy directory listings in the background.</li>
        <li>Queried, filtered, stopped, and received job output (including child jobs).</li>
        <li>Created a scheduled job with options (wake, elevated) and a one-time trigger.</li>
        <li>Built a scheduled task to remove disabled users from a group (via <code>PowerShell.exe</code> action).</li>
      </ul>
    </div>
    <div class="card">
      <h2>Verification</h2>
<pre class="code"># Running jobs visible?
Get-Job | Select Name,State,HasMoreData

# Only 'remote*' jobs?
Get-Job | Where-Object Name -match '^remote' | Select Name,State

# Results for a specific child job (e.g., LON-DC1 from RemoteDisks)
(Get-Job -Name RemoteDisks).ChildJobs |
  Where-Object Location -eq "LON-DC1" |
  Receive-Job

# Scheduled job created?
Get-ScheduledJob | Select Name,State,LastRunTime</pre>
    </div>
  </div>

  <div class="card">
    <h2>Troubleshooting & Root Cause</h2>
    <table class="table">
      <tr><th>Symptom</th><th>Likely Cause → Fix</th></tr>
      <tr>
        <td><strong>Invoke-Command : Access denied / cannot connect</strong></td>
        <td>WinRM disabled or firewall blocked → <code>Enable-PSRemoting -Force</code>, open TCP 5985/5986, verify DNS/cred delegation. Use <code>Test-WSMan</code>.</td>
      </tr>
      <tr>
        <td><strong>Jobs finish “Completed” but no output</strong></td>
        <td>Results not received → use <code>Receive-Job</code> (consider <code>-Keep</code>). Inspect <code>$job.JobStateInfo.Reason</code> for errors.</td>
      </tr>
      <tr>
        <td><strong>High CPU from many local jobs</strong></td>
        <td>Client-side fan‑out → switch to <code>Invoke-Command -AsJob</code> or throttle concurrency; aggregate results per node.</td>
      </tr>
      <tr>
        <td><strong>Scheduled job never runs</strong></td>
        <td>Trigger/timezone or privileges → verify trigger with <code>Get-JobTrigger</code>, set <code>-RunElevated</code>, check Task Scheduler History, and execution policy.</td>
      </tr>
      <tr>
        <td><strong>Child jobs show failures</strong></td>
        <td>Some targets offline → enumerate <code>.ChildJobs</code> and receive per target to isolate; retry only failed locations.</td>
      </tr>
    </table>
  </div>

  <div class="two">
    <div class="card">
      <h2>Ops / Exam Tips</h2>
      <ul>
        <li>Use clear job names for filtering (<code>RemoteShares</code>, <code>LocalSecurity</code>).</li>
        <li><code>Receive-Job</code> without <code>-Keep</code> clears buffered output—capture once, store if needed.</li>
        <li>For PS 7+, prefer <code>Start-ThreadJob</code> (module) for lightweight local concurrency.</li>
      </ul>
    </div>
    <div class="card">
      <h2>Try This (extra practice)</h2>
      <ul>
        <li>Create a daily trigger that runs a compliance script at 18:00.</li>
        <li>Start a remoting job to collect disk usage from all AD computers and export to CSV.</li>
        <li>Throttle fan‑out to 10 targets at a time and measure duration.</li>
      </ul>
<pre class="code"># Hints
$triggerDaily = New-JobTrigger -Daily -At 18:00
Register-ScheduledJob -Name DailyCompliance -Trigger $triggerDaily -ScriptBlock { &amp; C:\Scripts\compliance.ps1 }

$ad = (Get-ADComputer -Filter *).Name
Invoke-Command -ComputerName $ad -ScriptBlock {
  Get-PSDrive -PSProvider FileSystem | Select-Object Root,Used,Free
} -AsJob -JobName DiskScan

Measure-Command { Wait-Job DiskScan }
</pre>
    </div>
  </div>

  <hr>
  <div class="footer">
    Aligned with Microsoft Learning lab scope: Objectives, job types, and scheduled jobs (Lab 11). Print-friendly • Light theme.
  </div>
</div>
</body>
</html>
